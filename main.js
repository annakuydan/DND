(()=>{"use strict";function t(t,e){const n=t,s=e;let i=null,o=null,l=null;s.addEventListener("mousedown",(t=>{const e=function(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollX,left:e.left+window.scrollX}}(s),c=t.pageX-e.left,r=t.pageY-e.top;function a(t){s.style.left=t.pageX-c+"px",s.style.top=t.pageY-r+"px"}if("close"!==t.target.dataset.toggle){if(t.preventDefault(),i)return;l=document.createElement("div"),l.style.height=`${s.offsetHeight}px`,l.style.backgroundColor="#7b9bb1",s.parentElement.insertBefore(l,s),o=t.target.closest(".column").dataset.id,i=t.target,s.classList.add("dragged"),document.body.appendChild(s),a(t);const e=function(t){t.preventDefault(),i&&a(t)};n.addEventListener("mousemove",e),n.addEventListener("mouseup",(c=>{if(!i)return;l.remove();const r=document.elementFromPoint(c.clientX,c.clientY),a=JSON.parse(localStorage.columns),d=r.closest(".column"),u=d.dataset.id,m=a[o].findIndex((t=>t.id===+s.dataset.id)),h=a[o].splice(m,1);if("tikets-container"!==r.className){let e=r.closest(".tiket-group");if(!e)return;{const n=e.getBoundingClientRect().y+e.getBoundingClientRect().height/2;if(t.clientY>n){if(null===e.nextElementSibling)return;e=e.nextElementSibling}if(e.parentElement.insertBefore(s,e),s.classList.remove("dragged"),s.style.top=null,s.style.left=null,o===u){const t=a[o].findIndex((t=>t.id===+e.dataset.id));a[o].splice(t,0,h[0])}else{const t=a[u].findIndex((t=>t.id===+e.dataset.id));a[u].splice(t,0,h[0])}}}if("tikets-container"===r.className){Object.prototype.hasOwnProperty.call(a,u)||(a[u]=[]),h[0]&&a[u].push(h[0]),s.classList.remove("dragged"),n.removeEventListener("mousemove",e);d.querySelector(".tikets").append(s),s.style.top=null,s.style.left=null}localStorage.setItem("columns",JSON.stringify(a)),i=null}))}}))}class e{constructor(t){this.container=t,this.tiketgroup=null}bindToDom(t){this.tiketgroup=document.createElement("div"),this.tiketgroup.classList.add("tiket-group"),this.tiketgroup.setAttribute("data-id",t.id),this.tiketgroup.setAttribute("data-type","item"),this.tiketgroup.setAttribute("draggable","true"),this.tiketgroup.innerHTML='\n       <div class = "tiket"></div>\n       <button class="closeBtn" data-toggle="close">X</button>',this.tiketgroup.querySelector(".tiket").innerText=t.text,this.container.append(this.tiketgroup),this.closeTiketBtn()}closeTiketBtn(){const e=this.tiketgroup.querySelector(".closeBtn");this.tiketgroup.addEventListener("mouseover",(()=>{e.classList.add("hidden")})),this.tiketgroup.addEventListener("mouseout",(()=>{e.classList.remove("hidden")})),e.addEventListener("click",(()=>{this.tiketgroup.parentNode.removeChild(this.tiketgroup);const t=JSON.parse(localStorage.columns),e=this.container.closest(".column").dataset.id,n=t[e].findIndex((t=>t.id===+this.tiketgroup.dataset.id));t[e].splice(n,1),localStorage.setItem("columns",JSON.stringify(t))})),t(this.container.closest(".columns"),this.tiketgroup)}}class n{constructor(){this.container=null,this.form=document.createElement("form")}init(){this.form.setAttribute("novalidate","novalidate"),this.form.setAttribute("id","item-form"),this.form.innerHTML='\n       <textarea id="text" class="input" name="text" rows="3" cols="33" \n       placeholder="text" autocomplete="off"></textarea>\n       <div class=\'button-container\'>\n         <button type="submit" class="btnSubmit">Подтверждаю</button>\n         <button class="btnReset">X</button>\n       </div>',this.container.append(this.form),this.formElements=[...this.form.elements]}bindToDOM(t){this.container=t,this.init(),this.events()}events(){this.form.querySelector(".btnReset").addEventListener("click",(()=>this.closeForm())),this.form.addEventListener("submit",(t=>this.onSubmit(t)))}closeForm(){this.form.parentNode.removeChild(this.form)}onSubmit(t){t.preventDefault();const n={};this.formElements.forEach((t=>{t.name&&(n[t.name]=t.value)}));new e(this.container.querySelector(".tikets")).bindToDom(n),this.closeForm(),localStorage.getItem("columns")||localStorage.setItem("columns",JSON.stringify({}));const s=JSON.parse(localStorage.columns);Object.prototype.hasOwnProperty.call(s,this.container.dataset.id)||(s[this.container.dataset.id]=[]),s[this.container.dataset.id].push(n),localStorage.setItem("columns",JSON.stringify(s))}}class s{constructor(t){this.container=t,this.column=null}bindToDOM(t){this.column=document.createElement("div"),this.column.classList.add("column"),this.column.classList.add("column-droppable"),this.column.setAttribute("data-id",t.id),this.column.innerHTML=`\n      <h3 class = "title">${t.title}</h3>\n      <button class="btn"> + Добавить тикет</button>\n     <div class="tikets-container" data-type = "column">\n     <div class="tikets">\n     </div>\n     </div>\n     <div class="form-container"></div>\n     `,this.container.append(this.column),this.localColumn(t.id),this.addBtn()}addBtn(){this.column.querySelector(".btn").addEventListener("click",(()=>this.addItem()))}addItem(){if(!this.column.querySelector("form")&&!document.querySelector(".dragged")){(new n).bindToDOM(this.column)}}localColumn(t){if(localStorage.columns){const n=JSON.parse(localStorage.columns);n&&n[t]&&n[t].forEach((t=>{new e(this.column.querySelector(".tikets")).bindToDom(t)}))}}}new class{constructor(t){this.container=t,this.columns=document.querySelector(".columns")}bindToDOM(){this.InitColumns(),this.container.append(this.columns)}InitColumns(){this.column1=new s(this.columns),this.column2=new s(this.columns),this.column3=new s(this.columns),this.column1.bindToDOM({class:"column1",title:"TODO",id:"1"}),this.column2.bindToDOM({class:"column2",title:"In progress",id:"2"}),this.column3.bindToDOM({class:"column3",title:"Done",id:"3"})}}(document.querySelector(".trello")).bindToDOM()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cy90aWtldC5qcyIsIndlYnBhY2s6Ly9kbmQvLi9zcmMvanMvZm9ybS5qcyIsIndlYnBhY2s6Ly9kbmQvLi9zcmMvanMvY29sdW1uLmpzIiwid2VicGFjazovL2RuZC8uL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vZG5kLy4vc3JjL2pzL3RyZWxsby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkbmQoY29sdW1ucywgZWwpIHtcbiAgZnVuY3Rpb24gZ2V0Q29vcmRzKGVsZW0pIHtcbiAgICBjb25zdCBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6IGJveC50b3AgKyB3aW5kb3cuc2Nyb2xsWCxcbiAgICAgIGxlZnQ6IGJveC5sZWZ0ICsgd2luZG93LnNjcm9sbFgsXG4gICAgfTtcbiAgfVxuICBjb25zdCBjb250YWluZXIgPSBjb2x1bW5zO1xuICBjb25zdCBpdGVtID0gZWw7XG4gIGxldCBkcmFnZ2VkRWwgPSBudWxsO1xuICBsZXQgZGF0YUlkID0gbnVsbDtcbiAgbGV0IHdyYXBwZXIgPSBudWxsO1xuXG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHtcbiAgICBjb25zdCBjb29yZHMgPSBnZXRDb29yZHMoaXRlbSk7XG4gICAgY29uc3Qgc2hpZnRYID0gZS5wYWdlWCAtIGNvb3Jkcy5sZWZ0O1xuICAgIGNvbnN0IHNoaWZ0WSA9IGUucGFnZVkgLSBjb29yZHMudG9wO1xuXG4gICAgZnVuY3Rpb24gbW92ZUF0KGV2dCkge1xuICAgICAgaXRlbS5zdHlsZS5sZWZ0ID0gYCR7ZXZ0LnBhZ2VYIC0gc2hpZnRYfXB4YDtcbiAgICAgIGl0ZW0uc3R5bGUudG9wID0gYCR7ZXZ0LnBhZ2VZIC0gc2hpZnRZfXB4YDtcbiAgICB9XG5cbiAgICBpZiAoZS50YXJnZXQuZGF0YXNldC50b2dnbGUgIT09ICdjbG9zZScpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmIChkcmFnZ2VkRWwpIHJldHVybjtcblxuICAgICAgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgd3JhcHBlci5zdHlsZS5oZWlnaHQgPSBgJHtpdGVtLm9mZnNldEhlaWdodH1weGA7XG5cbiAgICAgIHdyYXBwZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyM3YjliYjEnO1xuICAgICAgaXRlbS5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZSh3cmFwcGVyLCBpdGVtKTtcblxuICAgICAgZGF0YUlkID0gZS50YXJnZXQuY2xvc2VzdCgnLmNvbHVtbicpLmRhdGFzZXQuaWQ7XG4gICAgICBkcmFnZ2VkRWwgPSBlLnRhcmdldDtcblxuICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2VkJyk7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGl0ZW0pO1xuXG4gICAgICBtb3ZlQXQoZSk7XG5cbiAgICAgIGNvbnN0IG1vdXNlTW92aW5nID0gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCFkcmFnZ2VkRWwpIHJldHVybjtcbiAgICAgICAgbW92ZUF0KGV2dCk7XG4gICAgICB9O1xuXG4gICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW91c2VNb3ZpbmcpO1xuXG4gICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcbiAgICAgICAgaWYgKCFkcmFnZ2VkRWwpIHJldHVybjtcblxuICAgICAgICB3cmFwcGVyLnJlbW92ZSgpO1xuXG4gICAgICAgIGNvbnN0IGNsb3Nlc3QgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGV2dC5jbGllbnRYLCBldnQuY2xpZW50WSk7XG5cbiAgICAgICAgY29uc3QgY29sdW1zTG9jYWwgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jb2x1bW5zKTtcbiAgICAgICAgY29uc3QgbmV3Q29sdW1uID0gY2xvc2VzdC5jbG9zZXN0KCcuY29sdW1uJyk7XG5cbiAgICAgICAgY29uc3QgbmV3Q29sdW1uSWQgPSBuZXdDb2x1bW4uZGF0YXNldC5pZDtcblxuICAgICAgICBjb25zdCBpbmRleCA9IGNvbHVtc0xvY2FsW2RhdGFJZF0uZmluZEluZGV4KChpKSA9PiBpLmlkID09PSAraXRlbS5kYXRhc2V0LmlkKTtcblxuICAgICAgICBjb25zdCB0b2RvTG9jYWwgPSBjb2x1bXNMb2NhbFtkYXRhSWRdLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgaWYgKGNsb3Nlc3QuY2xhc3NOYW1lICE9PSAndGlrZXRzLWNvbnRhaW5lcicpIHtcbiAgICAgICAgICBsZXQgaXRlbXNDb2x1bW4gPSBjbG9zZXN0LmNsb3Nlc3QoJy50aWtldC1ncm91cCcpO1xuXG4gICAgICAgICAgaWYgKGl0ZW1zQ29sdW1uKSB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSAqL1xuXHRcdFx0XHRcdFx0Y29uc3QgY2VudGVyID0gaXRlbXNDb2x1bW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueSArIGl0ZW1zQ29sdW1uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCAvIDI7XG5cblx0XHRcdFx0XHRcdGlmIChlLmNsaWVudFkgPiBjZW50ZXIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW1zQ29sdW1uLm5leHRFbGVtZW50U2libGluZyAhPT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW1zQ29sdW1uID0gaXRlbXNDb2x1bW4ubmV4dEVsZW1lbnRTaWJsaW5nO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpdGVtc0NvbHVtbi5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShpdGVtLCBpdGVtc0NvbHVtbik7XG5cdFx0XHRcdFx0XHRpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnZWQnKTtcblx0XHRcdFx0XHRcdGl0ZW0uc3R5bGUudG9wID0gbnVsbDtcblx0XHRcdFx0XHRcdGl0ZW0uc3R5bGUubGVmdCA9IG51bGw7XG5cblx0XHRcdFx0XHRcdGlmIChkYXRhSWQgPT09IG5ld0NvbHVtbklkKSB7XG5cdFx0XHRcdFx0XHRcdC8qIGVzbGludC1kaXNhYmxlICovXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGluZGV4QmVmb3JlID0gY29sdW1zTG9jYWxbZGF0YUlkXS5maW5kSW5kZXgoKGkpID0+IGkuaWQgPT09ICtpdGVtc0NvbHVtbi5kYXRhc2V0LmlkKTtcblx0XHRcdFx0XHRcdFx0Y29sdW1zTG9jYWxbZGF0YUlkXS5zcGxpY2UoaW5kZXhCZWZvcmUsIDAsIHRvZG9Mb2NhbFswXSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRjb25zdCBpbmRleEJlZm9yZSA9IGNvbHVtc0xvY2FsW25ld0NvbHVtbklkXS5maW5kSW5kZXgoKGkpID0+IGkuaWQgPT09ICtpdGVtc0NvbHVtbi5kYXRhc2V0LmlkKTtcblx0XHRcdFx0XHRcdFx0Y29sdW1zTG9jYWxbbmV3Q29sdW1uSWRdLnNwbGljZShpbmRleEJlZm9yZSwgMCwgdG9kb0xvY2FsWzBdKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNsb3Nlc3QuY2xhc3NOYW1lID09PSAndGlrZXRzLWNvbnRhaW5lcicpIHtcblx0XHRcdFx0XHQvKmlmICghY29sdW1zTG9jYWwuaGFzT3duUHJvcGVydHkobmV3Q29sdW1uSWQpKSBjb2x1bXNMb2NhbFtuZXdDb2x1bW5JZF0gPSBbXTsqL1xuICAgICAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb2x1bXNMb2NhbCwgbmV3Q29sdW1uSWQpKSBjb2x1bXNMb2NhbFtuZXdDb2x1bW5JZF0gPSBbXTtcblx0XHRcdFx0XHRpZiAodG9kb0xvY2FsWzBdKSBjb2x1bXNMb2NhbFtuZXdDb2x1bW5JZF0ucHVzaCh0b2RvTG9jYWxbMF0pO1xuXG5cdFx0XHRcdFx0aXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2VkJyk7XG5cdFx0XHRcdFx0Y29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdXNlTW92aW5nKTtcblxuXHRcdFx0XHRcdGNvbnN0IGNvbHVtbkl0ZW1zID0gbmV3Q29sdW1uLnF1ZXJ5U2VsZWN0b3IoJy50aWtldHMnKTtcblx0XHRcdFx0XHRjb2x1bW5JdGVtcy5hcHBlbmQoaXRlbSk7XG5cblx0XHRcdFx0XHRpdGVtLnN0eWxlLnRvcCA9IG51bGw7XG5cdFx0XHRcdFx0aXRlbS5zdHlsZS5sZWZ0ID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY29sdW1ucycsIEpTT04uc3RyaW5naWZ5KGNvbHVtc0xvY2FsKSk7XG5cdFx0XHRcdGRyYWdnZWRFbCA9IG51bGw7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufSIsImltcG9ydCBkbmQgZnJvbSAnLi9kbmQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbml0VGlrZXQge1xuICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLnRpa2V0Z3JvdXAgPSBudWxsO1xuICB9XG5cbiAgYmluZFRvRG9tKG8pIHtcbiAgICB0aGlzLnRpa2V0Z3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLnRpa2V0Z3JvdXAuY2xhc3NMaXN0LmFkZCgndGlrZXQtZ3JvdXAnKTtcbiAgICB0aGlzLnRpa2V0Z3JvdXAuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgby5pZCk7XG4gICAgdGhpcy50aWtldGdyb3VwLnNldEF0dHJpYnV0ZSgnZGF0YS10eXBlJywgJ2l0ZW0nKTtcbiAgICB0aGlzLnRpa2V0Z3JvdXAuc2V0QXR0cmlidXRlKCdkcmFnZ2FibGUnLCAndHJ1ZScpO1xuICAgIHRoaXMudGlrZXRncm91cC5pbm5lckhUTUwgPSBgXG4gICAgICAgPGRpdiBjbGFzcyA9IFwidGlrZXRcIj48L2Rpdj5cbiAgICAgICA8YnV0dG9uIGNsYXNzPVwiY2xvc2VCdG5cIiBkYXRhLXRvZ2dsZT1cImNsb3NlXCI+WDwvYnV0dG9uPmA7XG4gICAgdGhpcy50aWtldGdyb3VwLnF1ZXJ5U2VsZWN0b3IoJy50aWtldCcpLmlubmVyVGV4dCA9IG8udGV4dDtcbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQodGhpcy50aWtldGdyb3VwKTtcbiAgICB0aGlzLmNsb3NlVGlrZXRCdG4oKTtcbiAgfVxuXG4gIGNsb3NlVGlrZXRCdG4oKSB7XG4gICAgY29uc3QgY2xvc2VCdG4gPSB0aGlzLnRpa2V0Z3JvdXAucXVlcnlTZWxlY3RvcignLmNsb3NlQnRuJyk7XG5cbiAgICB0aGlzLnRpa2V0Z3JvdXAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgY2xvc2VCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnRpa2V0Z3JvdXAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoKSA9PiB7XG4gICAgICBjbG9zZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICB9KTtcblxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdGhpcy50aWtldGdyb3VwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50aWtldGdyb3VwKTtcbiAgICAgIGNvbnN0IGNvbHVtc0xvY2FsID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuY29sdW1ucyk7XG4gICAgICBjb25zdCBrZXkgPSB0aGlzLmNvbnRhaW5lci5jbG9zZXN0KCcuY29sdW1uJykuZGF0YXNldC5pZDtcbiAgICAgIGNvbnN0IGluZGV4ID0gY29sdW1zTG9jYWxba2V5XS5maW5kSW5kZXgoKHRpa2V0Z3JvdXApID0+IHRpa2V0Z3JvdXAuaWQgPT09ICt0aGlzLnRpa2V0Z3JvdXAuZGF0YXNldC5pZCk7XG4gICAgICBjb2x1bXNMb2NhbFtrZXldLnNwbGljZShpbmRleCwgMSk7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY29sdW1ucycsIEpTT04uc3RyaW5naWZ5KGNvbHVtc0xvY2FsKSk7XG4gICAgfSk7XG4gICAgZG5kKHRoaXMuY29udGFpbmVyLmNsb3Nlc3QoJy5jb2x1bW5zJyksIHRoaXMudGlrZXRncm91cCk7XG4gIH1cbn1cbiIsImltcG9ydCBJbml0VGlrZXQgZnJvbSAnLi90aWtldCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEluaXRGb3JtIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5mb3JtLnNldEF0dHJpYnV0ZSgnbm92YWxpZGF0ZScsICdub3ZhbGlkYXRlJyk7XG4gICAgdGhpcy5mb3JtLnNldEF0dHJpYnV0ZSgnaWQnLCAnaXRlbS1mb3JtJyk7XG5cbiAgICB0aGlzLmZvcm0uaW5uZXJIVE1MID0gYFxuICAgICAgIDx0ZXh0YXJlYSBpZD1cInRleHRcIiBjbGFzcz1cImlucHV0XCIgbmFtZT1cInRleHRcIiByb3dzPVwiM1wiIGNvbHM9XCIzM1wiIFxuICAgICAgIHBsYWNlaG9sZGVyPVwidGV4dFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiPjwvdGV4dGFyZWE+XG4gICAgICAgPGRpdiBjbGFzcz0nYnV0dG9uLWNvbnRhaW5lcic+XG4gICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImJ0blN1Ym1pdFwiPtCf0L7QtNGC0LLQtdGA0LbQtNCw0Y48L2J1dHRvbj5cbiAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG5SZXNldFwiPlg8L2J1dHRvbj5cbiAgICAgICA8L2Rpdj5gO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZCh0aGlzLmZvcm0pO1xuICAgIHRoaXMuZm9ybUVsZW1lbnRzID0gWy4uLnRoaXMuZm9ybS5lbGVtZW50c107XG4gIH1cblxuICBiaW5kVG9ET00oY29udGFpbmVyKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgdGhpcy5ldmVudHMoKTtcbiAgfVxuXG4gIGV2ZW50cygpIHtcbiAgICBjb25zdCBidG5SZXNldCA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCcuYnRuUmVzZXQnKTtcblxuICAgIGJ0blJlc2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jbG9zZUZvcm0oKSk7IC8vIDJcblxuICAgIHRoaXMuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4gdGhpcy5vblN1Ym1pdChlKSk7IC8vIDJcbiAgfVxuXG4gIGNsb3NlRm9ybSgpIHtcbiAgICB0aGlzLmZvcm0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmZvcm0pO1xuICB9XG5cbiAgb25TdWJtaXQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBmb3JtRGF0YSA9IHt9O1xuICAgIHRoaXMuZm9ybUVsZW1lbnRzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBpZiAoIWVsLm5hbWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9ybURhdGFbZWwubmFtZV0gPSBlbC52YWx1ZTtcbiAgICB9KTtcbiAgICBjb25zdCBpbml0dGlrZXQgPSBuZXcgSW5pdFRpa2V0KHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50aWtldHMnKSk7XG5cbiAgICBpbml0dGlrZXQuYmluZFRvRG9tKGZvcm1EYXRhKTtcblxuICAgIHRoaXMuY2xvc2VGb3JtKCk7XG5cbiAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjb2x1bW5zJykpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjb2x1bW5zJywgSlNPTi5zdHJpbmdpZnkoe30pKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb2x1bW5zTG9jYWwgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jb2x1bW5zKTtcbiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb2x1bW5zTG9jYWwsIHRoaXMuY29udGFpbmVyLmRhdGFzZXQuaWQpKSB7XG4gICAgICBjb2x1bW5zTG9jYWxbdGhpcy5jb250YWluZXIuZGF0YXNldC5pZF0gPSBbXTtcbiAgICB9XG5cbiAgICBjb2x1bW5zTG9jYWxbdGhpcy5jb250YWluZXIuZGF0YXNldC5pZF0ucHVzaChmb3JtRGF0YSk7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY29sdW1ucycsIEpTT04uc3RyaW5naWZ5KGNvbHVtbnNMb2NhbCkpO1xuICB9XG59XG4iLCJpbXBvcnQgSW5pdFRpa2V0IGZyb20gJy4vdGlrZXQnO1xuaW1wb3J0IEluaXRGb3JtIGZyb20gJy4vZm9ybSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEluaXRDb2x1bW4ge1xuICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmNvbHVtbiA9IG51bGw7XG4gIH1cblxuICBiaW5kVG9ET00obykge1xuICAgIHRoaXMuY29sdW1uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5jb2x1bW4uY2xhc3NMaXN0LmFkZCgnY29sdW1uJyk7XG4gICAgdGhpcy5jb2x1bW4uY2xhc3NMaXN0LmFkZCgnY29sdW1uLWRyb3BwYWJsZScpO1xuICAgIHRoaXMuY29sdW1uLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIG8uaWQpO1xuXG4gICAgdGhpcy5jb2x1bW4uaW5uZXJIVE1MID0gYFxuICAgICAgPGgzIGNsYXNzID0gXCJ0aXRsZVwiPiR7by50aXRsZX08L2gzPlxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0blwiPiArINCU0L7QsdCw0LLQuNGC0Ywg0YLQuNC60LXRgjwvYnV0dG9uPlxuICAgICA8ZGl2IGNsYXNzPVwidGlrZXRzLWNvbnRhaW5lclwiIGRhdGEtdHlwZSA9IFwiY29sdW1uXCI+XG4gICAgIDxkaXYgY2xhc3M9XCJ0aWtldHNcIj5cbiAgICAgPC9kaXY+XG4gICAgIDwvZGl2PlxuICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1jb250YWluZXJcIj48L2Rpdj5cbiAgICAgYDtcblxuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZCh0aGlzLmNvbHVtbik7XG4gICAgdGhpcy5sb2NhbENvbHVtbihvLmlkKTtcbiAgICB0aGlzLmFkZEJ0bigpO1xuICB9XG5cbiAgYWRkQnRuKCkge1xuICAgIGNvbnN0IGFkZEJ0biA9IHRoaXMuY29sdW1uLnF1ZXJ5U2VsZWN0b3IoJy5idG4nKTtcbiAgICBhZGRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLmFkZEl0ZW0oKSk7XG4gIH1cblxuICBhZGRJdGVtKCkge1xuICAgIGlmICghdGhpcy5jb2x1bW4ucXVlcnlTZWxlY3RvcignZm9ybScpICYmICFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZHJhZ2dlZCcpKSB7XG4gICAgICBjb25zdCBpbml0Rm9ybSA9IG5ldyBJbml0Rm9ybSgpO1xuICAgICAgaW5pdEZvcm0uYmluZFRvRE9NKHRoaXMuY29sdW1uKTtcbiAgICB9XG4gIH1cblxuICBsb2NhbENvbHVtbihpZCkge1xuICAgIGlmIChsb2NhbFN0b3JhZ2UuY29sdW1ucykge1xuICAgICAgY29uc3QgY29sdW1uc0xvY2FsID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuY29sdW1ucyk7XG4gICAgICBpZiAoY29sdW1uc0xvY2FsKSB7XG4gICAgICAgIGlmIChjb2x1bW5zTG9jYWxbaWRdKSB7XG4gICAgICAgICAgY29sdW1uc0xvY2FsW2lkXS5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5pdHRpa2V0ID0gbmV3IEluaXRUaWtldCh0aGlzLmNvbHVtbi5xdWVyeVNlbGVjdG9yKCcudGlrZXRzJykpO1xuICAgICAgICAgICAgaW5pdHRpa2V0LmJpbmRUb0RvbShlbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCBDb2x1bW5zIGZyb20gJy4vdHJlbGxvJztcblxuY29uc3QgY29sdW1ucyA9IG5ldyBDb2x1bW5zKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50cmVsbG8nKSk7XG5jb2x1bW5zLmJpbmRUb0RPTSgpO1xuIiwiaW1wb3J0IEluaXRDb2x1bW4gZnJvbSAnLi9jb2x1bW4nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2x1bW5zIHtcbiAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5jb2x1bW5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbHVtbnMnKTtcbiAgfVxuXG4gIGJpbmRUb0RPTSgpIHtcbiAgICB0aGlzLkluaXRDb2x1bW5zKCk7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuY29sdW1ucyk7XG4gIH1cblxuICBJbml0Q29sdW1ucygpIHtcbiAgICB0aGlzLmNvbHVtbjEgPSBuZXcgSW5pdENvbHVtbih0aGlzLmNvbHVtbnMpO1xuICAgIHRoaXMuY29sdW1uMiA9IG5ldyBJbml0Q29sdW1uKHRoaXMuY29sdW1ucyk7XG4gICAgdGhpcy5jb2x1bW4zID0gbmV3IEluaXRDb2x1bW4odGhpcy5jb2x1bW5zKTtcblxuICAgIHRoaXMuY29sdW1uMS5iaW5kVG9ET00oe1xuICAgICAgY2xhc3M6ICdjb2x1bW4xJyxcbiAgICAgIHRpdGxlOiAnVE9ETycsXG4gICAgICBpZDogJzEnLFxuICAgIH0pO1xuICAgIHRoaXMuY29sdW1uMi5iaW5kVG9ET00oe1xuICAgICAgY2xhc3M6ICdjb2x1bW4yJyxcbiAgICAgIHRpdGxlOiAnSW4gcHJvZ3Jlc3MnLFxuICAgICAgaWQ6ICcyJyxcbiAgICB9KTtcbiAgICB0aGlzLmNvbHVtbjMuYmluZFRvRE9NKHtcbiAgICAgIGNsYXNzOiAnY29sdW1uMycsXG4gICAgICB0aXRsZTogJ0RvbmUnLFxuICAgICAgaWQ6ICczJyxcbiAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImRuZCIsImNvbHVtbnMiLCJlbCIsImNvbnRhaW5lciIsIml0ZW0iLCJkcmFnZ2VkRWwiLCJkYXRhSWQiLCJ3cmFwcGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJjb29yZHMiLCJlbGVtIiwiYm94IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwid2luZG93Iiwic2Nyb2xsWCIsImxlZnQiLCJnZXRDb29yZHMiLCJzaGlmdFgiLCJwYWdlWCIsInNoaWZ0WSIsInBhZ2VZIiwibW92ZUF0IiwiZXZ0Iiwic3R5bGUiLCJ0YXJnZXQiLCJkYXRhc2V0IiwidG9nZ2xlIiwicHJldmVudERlZmF1bHQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJoZWlnaHQiLCJvZmZzZXRIZWlnaHQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJwYXJlbnRFbGVtZW50IiwiaW5zZXJ0QmVmb3JlIiwiY2xvc2VzdCIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwiYm9keSIsImFwcGVuZENoaWxkIiwibW91c2VNb3ZpbmciLCJyZW1vdmUiLCJlbGVtZW50RnJvbVBvaW50IiwiY2xpZW50WCIsImNsaWVudFkiLCJjb2x1bXNMb2NhbCIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsIm5ld0NvbHVtbiIsIm5ld0NvbHVtbklkIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJpIiwidG9kb0xvY2FsIiwic3BsaWNlIiwiY2xhc3NOYW1lIiwiaXRlbXNDb2x1bW4iLCJjZW50ZXIiLCJ5IiwibmV4dEVsZW1lbnRTaWJsaW5nIiwiaW5kZXhCZWZvcmUiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJwdXNoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmQiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiSW5pdFRpa2V0IiwiY29uc3RydWN0b3IiLCJ0aGlzIiwidGlrZXRncm91cCIsImJpbmRUb0RvbSIsIm8iLCJzZXRBdHRyaWJ1dGUiLCJpbm5lckhUTUwiLCJpbm5lclRleHQiLCJ0ZXh0IiwiY2xvc2VUaWtldEJ0biIsImNsb3NlQnRuIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwia2V5IiwiSW5pdEZvcm0iLCJmb3JtIiwiaW5pdCIsImZvcm1FbGVtZW50cyIsImVsZW1lbnRzIiwiYmluZFRvRE9NIiwiZXZlbnRzIiwiY2xvc2VGb3JtIiwib25TdWJtaXQiLCJmb3JtRGF0YSIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJnZXRJdGVtIiwiY29sdW1uc0xvY2FsIiwiSW5pdENvbHVtbiIsImNvbHVtbiIsInRpdGxlIiwibG9jYWxDb2x1bW4iLCJhZGRCdG4iLCJhZGRJdGVtIiwiSW5pdENvbHVtbnMiLCJjb2x1bW4xIiwiY29sdW1uMiIsImNvbHVtbjMiLCJjbGFzcyJdLCJzb3VyY2VSb290IjoiIn0=